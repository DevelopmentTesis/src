<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Publicacion">

	<resultMap id="result" type="Publicacion">
		<result property="idTipoPublicacion" column="ID_TIPO_PUBLICACION" />
		<result property="descrTipo" column="DESCR_TIPO" />
		<result property="usuario.idUsuario" column="ID_USUARIO" />
		<result property="usuario.nombre" column="NOMBRE" />
		<result property="comentario" column="COMENTARIO" />
		<result property="precio" column="PRECIO" />
		<result property="tienda" column="TIENDA" />
		<result property="fechaPublicacion" column="FECHA_PUBLICACION" />
		<result property="idEstado" column="idEstado" />
		<result property="geolocalizacion.cordLatitud" column="LATITUD" />
		<result property="geolocalizacion.cordLonguitud" column="LONGUITUD" />
	</resultMap>

	<resultMap id="resulTipo" type="TipoPublicacion">
		<result property="idPublicacion" column="ID_TIPO_PUBLICACION" />
		<result property="descripcion" column="DESCR_TIPO" />
	</resultMap>


	<select id="getPublicaciones" statementType="CALLABLE"
		resultMap="result">
		{call sp_publicaciones()}
	</select>

	<select id="getTipoPublicaciones" resultMap="resulTipo">
		SELECT * FROM TIPO_PUBLICACION
	</select>


	<select id="buscarPublicaciones" statementType="CALLABLE"
		resultMap="result">
		{call
		sp_buscarPublicaciones(#{id,jdbcType=INTEGER,mode=IN})}
	</select>


	<insert id="guardarPublicacion" statementType="CALLABLE">
		{call
		sp_guardarPublicacion(
		#{usuario.idUsuario,jdbcType=INTEGER,mode=IN},
		#{idTipoPublicacion,jdbcType=INTEGER, mode=IN},
		#{geolocalizacion.cordLatitud,jdbcType=VARCHAR, mode=IN},
		#{geolocalizacion.cordLonguitud,jdbcType=VARCHAR,mode=IN},
		#{comentario,jdbcType=VARCHAR, mode=IN},
		#{precio,jdbcType=INTEGER,
		mode=IN},
		#{tienda,jdbcType=VARCHAR,mode=IN}
		)}
	</insert>

</mapper>